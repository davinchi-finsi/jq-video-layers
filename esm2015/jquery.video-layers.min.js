/**
 * @license jq-video-layers v0.0.1
 * (c) 2018 Finsi, Inc.
 */

class VideoLayer{constructor(e={}){void 0!=e.element&&(this.element=e.element),void 0!=e.content&&(this.content=e.content),void 0!=e.position&&(this.position=e.position),void 0!=e.cssClass&&(this.cssClass=e.cssClass),void 0!=e.styles&&(this.styles=e.styles),void 0!=e.start&&(this.start=e.start),void 0!=e.stop&&(this.stop=e.stop),void 0!=e.show&&(this.show=e.show),void 0!=e.hide&&(this.hide=e.hide),void 0!=e.appendToLayers&&(this.appendToLayers=e.appendToLayers)}}var VideoLayersEvents;!function(e){e.beforeShowLayer="videoLayer:beforeShowLayer",e.showLayer="videoLayer:showLayer",e.beforeHideLayer="videoLayer:beforeHideLayer",e.hideLayer="videoLayer:hideLayer"}(VideoLayersEvents||(VideoLayersEvents={}));class VideoLayers{destroy(){this.element.unwrap(),this._super()}addLayer(e){}_getCreateOptions(){return{namespace:"jq-videolayers",classes:{root:"c-video-layers",video:"c-video-layers__video",layer:"c-video-layers__layer",visible:"c-video-layers__visible",layersContainer:"c-video-layers__container"},layers:[]}}_create(){const e=this.options.useParentAsContainer;if(e)if("string"==typeof e){if(this.wrapperEl=this.element.parents(e),0==this.wrapperEl.length)throw"[VideoLayers] useParentAsContainer must match with an existing element, the query provided doesn't match with any element"}else this.wrapperEl=e;else this.wrapperEl=$(`<div></div>`),this.wrapperEl.insertAfter(this.element),this.element.appendTo(this.wrapperEl);this.wrapperEl.addClass(this.options.classes.root),this.layersContainer=$(`<div class="${this.options.classes.layersContainer}"></div>`),this.wrapperEl.append(this.layersContainer),this.element.addClass(this.options.classes.video),this.layers=[],this.visibleLayers=[],this.hiddenLayers=[],this._assignEvents(),this._processLayers(this.options.layers)}_onTimeUpdate(e){const s=e.target.currentTime;let t=this.visibleLayers,i=this.hiddenLayers,o=[],n=[];for(let e=0,t=i.length;e<t;e++){let n=i[e];s>=n.start&&(void 0==n.stop||s<n.stop)&&(this._showLayer(n),o.push(i.splice(e,1)[0]),t--,e--)}for(let e=0,i=t.length;e<i;e++){let o=t[e];(s>=o.stop||s<o.start)&&(this._hideLayer(o),n.push(t.splice(e,1)[0]),i--,e--)}this.visibleLayers=t.concat(o),this.hiddenLayers=i.concat(n)}_assignEvents(){this.element.off("."+this.options.namespace),this.element.on(`timeupdate.${this.options.namespace}`,this._onTimeUpdate.bind(this))}_showLayer(e){const s=e.element;this.element.trigger(VideoLayersEvents.beforeShowLayer,{instance:this,layer:e}),s.addClass(this.options.classes.visible),e.position&&(Array.isArray(e.position)?s.css({left:e.position[0],top:e.position[1]}):(e.position.of=e.position.of||this.wrapperEl,s.position(e.position))),e.show?(e.show.complete=(()=>{this.element.trigger(VideoLayersEvents.showLayer,{instance:this,layer:e})}),s.show(e.show)):(s.show(),this.element.trigger(VideoLayersEvents.showLayer,{instance:this,layer:e}))}_hideLayer(e){const s=e.element;this.element.trigger(VideoLayersEvents.beforeHideLayer,{instance:this,layer:e}),e.hide?(e.hide.complete=(()=>{s.removeClass(this.options.classes.visible);this._resetPosition(e);this.element.trigger(VideoLayersEvents.hideLayer,{instance:this,layer:e})}),s.hide(e.hide)):(s.hide().removeClass(this.options.classes.visible),this._resetPosition(e),this.element.trigger(VideoLayersEvents.hideLayer,{instance:this,layer:e}))}_resetPosition(e){e.position&&!Array.isArray(e.position)&&e.element.css({left:"",top:""})}_processLayers(e){let s=[];for(let t=0,i=e.length;t<i;t++){let i,o=new VideoLayer($.extend(!0,{},e[t]));if(o.element?("string"==typeof o.element&&(o.element=$(o.element)),0!=o.appendToLayers&&this.layersContainer.append(o.element)):(o.element=$(`<div>${o.content}</div>`),this.layersContainer.append(o.element)),void 0==(i=o.element)||0==i.length)throw"[VideoLayers] The layer must has an element or a content";i.addClass(this.options.classes.layer),o.styles&&i.css(o.styles),i.addClass(o.cssClass),s.push(o)}this.layers=this.layers.concat(s),this.hiddenLayers=this.hiddenLayers.concat(s)}}if(Object.hasOwnProperty("getOwnPropertyDescriptors")){let e={},s=Object.getOwnPropertyNames(VideoLayers.prototype);for(let t=0,i=s.length;t<i;t++){let i=s[t];e[i]=Object.getOwnPropertyDescriptor(VideoLayers.prototype,i).value}$.widget("ui.videoLayers",e)}else $.widget("ui.videoLayers",VideoLayers);export{VideoLayer,VideoLayersEvents,VideoLayers};
