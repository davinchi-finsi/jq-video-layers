/**
 * @license jq-video-layers v0.0.1
 * (c) 2018 Finsi, Inc.
 */

!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s(e.jqVideoLayers={})}(this,function(e){"use strict";var s,t=function(){return function(e){void 0===e&&(e={}),void 0!=e.element&&(this.element=e.element),void 0!=e.content&&(this.content=e.content),void 0!=e.position&&(this.position=e.position),void 0!=e.cssClass&&(this.cssClass=e.cssClass),void 0!=e.styles&&(this.styles=e.styles),void 0!=e.start&&(this.start=e.start),void 0!=e.stop&&(this.stop=e.stop),void 0!=e.show&&(this.show=e.show),void 0!=e.hide&&(this.hide=e.hide),void 0!=e.appendToLayers&&(this.appendToLayers=e.appendToLayers)}}();(s=e.VideoLayersEvents||(e.VideoLayersEvents={})).beforeShowLayer="videoLayer:beforeShowLayer",s.showLayer="videoLayer:showLayer",s.beforeHideLayer="videoLayer:beforeHideLayer",s.hideLayer="videoLayer:hideLayer";var i=function(){function s(){}return s.prototype.destroy=function(){this.element.unwrap(),this._super()},s.prototype.addLayer=function(e){},s.prototype._getCreateOptions=function(){return{namespace:"jq-videolayers",classes:{root:"c-video-layers",video:"c-video-layers__video",layer:"c-video-layers__layer",visible:"c-video-layers__visible",layersContainer:"c-video-layers__container"},layers:[]}},s.prototype._create=function(){var e=this.options.useParentAsContainer;if(e)if("string"==typeof e){if(this.wrapperEl=this.element.parents(e),0==this.wrapperEl.length)throw"[VideoLayers] useParentAsContainer must match with an existing element, the query provided doesn't match with any element"}else this.wrapperEl=e;else this.wrapperEl=$("<div></div>"),this.wrapperEl.insertAfter(this.element),this.element.appendTo(this.wrapperEl);this.wrapperEl.addClass(this.options.classes.root),this.layersContainer=$('<div class="'+this.options.classes.layersContainer+'"></div>'),this.wrapperEl.append(this.layersContainer),this.element.addClass(this.options.classes.video),this.layers=[],this.visibleLayers=[],this.hiddenLayers=[],this._assignEvents(),this._processLayers(this.options.layers)},s.prototype._onTimeUpdate=function(e){for(var s=e.target.currentTime,t=this.visibleLayers,i=this.hiddenLayers,o=[],r=[],n=0,a=i.length;n<a;n++){var h=i[n];s>=h.start&&(void 0==h.stop||s<h.stop)&&(this._showLayer(h),o.push(i.splice(n,1)[0]),a--,n--)}for(var p=0,l=t.length;p<l;p++){var d=t[p];(s>=d.stop||s<d.start)&&(this._hideLayer(d),r.push(t.splice(p,1)[0]),l--,p--)}this.visibleLayers=t.concat(o),this.hiddenLayers=i.concat(r)},s.prototype._assignEvents=function(){this.element.off("."+this.options.namespace),this.element.on("timeupdate."+this.options.namespace,this._onTimeUpdate.bind(this))},s.prototype._showLayer=function(s){var t=this,i=s.element;this.element.trigger(e.VideoLayersEvents.beforeShowLayer,{instance:this,layer:s}),i.addClass(this.options.classes.visible),s.position&&(Array.isArray(s.position)?i.css({left:s.position[0],top:s.position[1]}):(s.position.of=s.position.of||this.wrapperEl,i.position(s.position))),s.show?(s.show.complete=function(){t.element.trigger(e.VideoLayersEvents.showLayer,{instance:t,layer:s})},i.show(s.show)):(i.show(),this.element.trigger(e.VideoLayersEvents.showLayer,{instance:this,layer:s}))},s.prototype._hideLayer=function(s){var t=this,i=s.element;this.element.trigger(e.VideoLayersEvents.beforeHideLayer,{instance:this,layer:s}),s.hide?(s.hide.complete=function(){i.removeClass(t.options.classes.visible),t._resetPosition(s),t.element.trigger(e.VideoLayersEvents.hideLayer,{instance:t,layer:s})},i.hide(s.hide)):(i.hide().removeClass(this.options.classes.visible),this._resetPosition(s),this.element.trigger(e.VideoLayersEvents.hideLayer,{instance:this,layer:s}))},s.prototype._resetPosition=function(e){e.position&&!Array.isArray(e.position)&&e.element.css({left:"",top:""})},s.prototype._processLayers=function(e){for(var s=[],i=0,o=e.length;i<o;i++){var r=new t($.extend(!0,{},e[i])),n=void 0;if(r.element?("string"==typeof r.element&&(r.element=$(r.element)),0!=r.appendToLayers&&this.layersContainer.append(r.element)):(r.element=$("<div>"+r.content+"</div>"),this.layersContainer.append(r.element)),void 0==(n=r.element)||0==n.length)throw"[VideoLayers] The layer must has an element or a content";n.addClass(this.options.classes.layer),r.styles&&n.css(r.styles),n.addClass(r.cssClass),s.push(r)}this.layers=this.layers.concat(s),this.hiddenLayers=this.hiddenLayers.concat(s)},s}();if(Object.hasOwnProperty("getOwnPropertyDescriptors")){for(var o={},r=Object.getOwnPropertyNames(i.prototype),n=0,a=r.length;n<a;n++){var h=r[n];o[h]=Object.getOwnPropertyDescriptor(i.prototype,h).value}$.widget("ui.videoLayers",o)}else $.widget("ui.videoLayers",i);e.VideoLayer=t,e.VideoLayers=i,Object.defineProperty(e,"__esModule",{value:!0})});
